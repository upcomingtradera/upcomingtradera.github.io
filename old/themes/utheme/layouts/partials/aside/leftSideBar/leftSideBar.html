{{ define "topArticlesCSS" }}
{{- $style := resources.Get .Site.Params.css.topArticles | resources.ToCSS | resources.Minify | resources.Fingerprint -}} 
<link rel="stylesheet" href="{{ $style.Permalink }}" integrity="{{ $style.Data.Integrity }}">
{{ end }}


{{ partial "tools/article-selector" . }}
{{ $topArticles := .Scratch.Get "topArticles" }}


<h2 class="topArticlesSectionHeadline">TOP POSTS</h2>
{{ $limit := 150 }}
<ul class="topArticlesContainer">
{{ range $topArticles }}
	<li class="topArticleItem">
		<a class="topArticlesHeaderSplashImageLink" href="{{ .Permalink }}">
			{{ $pageTitle := .Title | urlize }}
			{{ $context := dict "context" . "articleType" "topArticles" }}
			{{ partial "tools/resize-images" $context }}

			{{ $smallFN := .Scratch.Get "smallJPGFileName" }}
			{{ $smallJPG := .Scratch.Get "smallJPG" }}
			{{ $mediumJPG := .Scratch.Get "mediumJPG" }}
			{{ $largeJPG := .Scratch.Get "largeJPG" }}

			{{ $smallWEBP := .Scratch.Get "smallWEBP" }}
			{{ $mediumWEBP := .Scratch.Get "mediumWEBP" }}
			{{ $largeWEBP := .Scratch.Get "largeWEBP" }}
			{{ $pageTitle := .Title | urlize }}
			<picture>
				<source type="image/webp" 
					srcset="{{ $smallWEBP.RelPermalink }} {{ .Site.Params.topArticles.small }}w,
						{{ $mediumWEBP.RelPermalink }} {{ .Site.Params.topArticles.medium }}w,
						{{ $largeWEBP.RelPermalink }} {{ .Site.Params.topArticles.large }}w" 
					sizes="(max-width: 400px) 100vw, (max-width: 800px) 50vw, {{ .Site.Params.topArticles.large }}w">

				<source type="image/jpeg" 
					srcset="{{ $smallJPG.RelPermalink }} {{ .Site.Params.topArticles.small }}w,
						{{ $mediumJPG.RelPermalink }} {{ .Site.Params.topArticles.medium }}w,
						{{ $largeJPG.RelPermalink }} {{ .Site.Params.topArticles.large }}w" 
					sizes="(max-width: 400px) 100vw, (max-width: 800px) 50vw, {{ .Site.Params.topArticles.large }}w">

				<img class="topArticlesSplashImage"
				     src="{{ $largeJPG.RelPermalink }}" 
				     alt="{{ $pageTitle }}" 
				     style="width:auto;max-width:100%;">

			</picture>
		</a>
		<h2 class="topArticlesHeadline"><a class="topArticlesHeadlineLink" href="{{ .Permalink }}">{{ .Title }}</a></h2>
		<p class="topArticlesIntroBlurb">{{ truncate $limit ""  .Content | plainify | safeHTML }}</p>
	</li>
	{{ end }}
</ul>
